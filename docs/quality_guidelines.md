# 品質ガイドライン（Quality Guidelines）

**対象プロジェクト:** backcast（Webアプリケーション / Electronアプリケーション）

> 本ドキュメントは、[プロジェクト仕様書](./project_specification.md)と整合性を保ちながら、品質保証の基準・プロセス・チェックリストを定義します。

## 1. 品質保証の目的と範囲

**目的**
本ドキュメントは、backcast の品質を確保し、継続的に改善するための基準・プロセス・チェックリストを定めることを目的とします。品質保証（QA）は単なるテストにとどまらず、プロジェクト全体のプロセスとアウトプットを品質目標に適合させる仕組みとして位置づけます。([ONES.com][1])

**範囲**
本ガイドラインは、以下を対象とします。

* 開発プロセス全体における品質保証活動
* 機能・非機能要件の検証
* 自動および手動テストの計画・実行
* コード品質とセキュリティ基準
* リリース前品質チェック

---

## 2. 品質基準（Quality Criteria）

品質は以下の観点で評価されます。これらはソフトウェア品質属性として一般的に用いられる基準です。

### 2.1 機能性（Functional Suitability）

* 要件仕様に対して機能が正しく実装されていること
* ユーザーストーリーごとの期待結果が達成されていること

### 2.2 使いやすさ（Usability）

* UI/UX が一貫性を保ち、ユーザーに直感的であること
* エラーメッセージや入力制御が適切に設計されていること

### 2.3 性能（Performance）

* **3Dレンダリング**: 60fpsを維持する3Dモードのパフォーマンス
* **起動時間**: アプリケーションの起動時間を最小化
* **応答時間**: セル実行、モード切り替え、UI操作の応答性
* **大規模データ対応**: 大量のセルやデータを効率的に処理
* **スケーラビリティ**: 負荷時の性能が担保されていること

### 2.4 セキュリティ（Security）

* **入力検証**: Zodによるスキーマバリデーションの実施
* **XSS対策**: DOM操作時の適切なサニタイゼーション（`dompurify`の使用）
* **WebSocket通信**: セキュアな通信プロトコルの確保
* **機密情報保護**: 認証トークン、パスワードなどのログ出力禁止
* **脆弱性スキャン**: 定期的な依存関係の脆弱性チェック

### 2.5 信頼性・安定性（Reliability）

* サービスが安定して稼働し、クラッシュや重大な欠陥が存在しないこと

---

## 3. 品質保証プロセス

品質保証活動は、開発ライフサイクル全体に統合されるべきです。

### 3.1 テスト計画（Test Planning）

* 実施するテストタイプ（機能・UI・パフォーマンス・セキュリティ）の定義
* テストスコープ、成功基準（pass/fail criteria）の明確化
* テスト環境の設定、必要なテストデータの準備

*ベストプラクティスとして、チェックリストやテストプランを事前に用意します。*([katalon.com][2])

### 3.2 テスト設計・実行（Test Design & Execution）

#### 3.2.1 テスト階層

* **ユニットテスト（Vitest）**: 関数、ユーティリティ、ロジックの単体テスト
* **コンポーネントテスト（Vitest + Testing Library）**: Reactコンポーネントのテスト
* **統合テスト**: フロントエンドとバックエンドの統合テスト
* **E2Eテスト（Playwright）**: エンドツーエンドのシナリオテスト

#### 3.2.2 テスト実行プロセス

* **3段階デバッグプロセス**: Backend → Frontend → E2E の順でテスト実行
* **問題切り分け**: 最小単位のテストで原因を特定してから修正
* **テストカバレッジ**: 新機能には必ずテストを追加し、カバレッジを確保
* **不具合追跡**: テスト実行時に発見された不具合は適切に記録・追跡

#### 3.2.3 プロジェクト固有のテスト要件

* **Gridモード**: グリッドレイアウトの配置・編集・保存機能のテスト
* **3Dモード**: 3D空間でのセル配置、操作、レンダリング性能のテスト
* **モード切り替え**: Gridモードと3Dモード間のシームレスな切り替えのテスト
* **Pythonコード実行**: セル単位でのコード実行と結果表示のテスト
* **Dashboard出力**: 実行結果のDashboard形式での表示のテスト

### 3.3 品質ゲート（Quality Gates）

開発ステージごとの合格基準を設定し、以下の品質ゲートを通過する必要があります。

#### 3.3.1 コード品質ゲート

* **型チェック**: TypeScriptの型チェックがパスすること（`pnpm typecheck`）
* **リンター**: Biomeによるコード品質チェックがパスすること（`pnpm lint`）
* **重大な欠陥**: 重大・高優先度のバグがゼロであること

#### 3.3.2 テスト品質ゲート

* **ユニットテスト**: すべてのユニットテストがパスすること
* **統合テスト**: フロントエンド統合テストがパスすること（バックエンドサーバー起動必須）
* **E2Eテスト**: 主要なE2Eシナリオがパスすること
* **テストカバレッジ**: 新機能・変更箇所のテストカバレッジを確保すること

#### 3.3.3 ビルド品質ゲート

* **ビルド成功**: フロントエンドとバックエンドのビルドが成功すること
* **依存関係**: 脆弱性のある依存関係がないこと

### 3.4 継続的インテグレーション（CI）

#### 3.4.1 CIパイプラインの構成

* **型チェック**: TypeScriptの型チェック実行
* **リンター**: Biomeによるコード品質チェック（`pnpm lint`）
* **ビルド検証**: フロントエンドとバックエンドのビルド成功確認
* **テスト実行**: ユニットテスト、統合テスト、E2Eテストの自動実行
* **コードカバレッジ**: テストカバレッジの測定とレポート生成

#### 3.4.2 使用ツール

* **Biome**: コードフォーマット・リンター（`@biomejs/biome` 2.3.8）
* **Vitest**: ユニットテスト・コンポーネントテスト（`vitest` 3.2.4）
* **Playwright**: E2Eテスト（`@playwright/test` 1.57.0）
* **Codecov**: コードカバレッジの可視化（`@codecov/vite-plugin`）

#### 3.4.3 CI実行の前提条件

* **バックエンドサーバー**: 統合テスト・E2Eテスト実行時はサーバーが起動していること
* **環境変数**: 必要な環境変数が設定されていること

---

## 4. 品質チェックリスト

以下は、リリース前に必ず確認すべきチェックポイントです。

### 4.1 機能チェック

#### 4.1.1 コア機能

* **Gridモード**: セルのグリッドレイアウト配置・編集・保存が正常に動作するか
* **3Dモード**: セルの3D空間配置・操作・レンダリングが正常に動作するか
* **モード切り替え**: Gridモードと3Dモード間の切り替えがシームレスに動作するか
* **Pythonコード実行**: セル単位でのコード実行と結果表示が正常に動作するか
* **Dashboard出力**: 実行結果のDashboard形式での表示が正常に動作するか

#### 4.1.2 エディタ機能

* **CodeMirror統合**: Python、Markdown、SQLなどの言語サポートが正常に動作するか
* **オートコンプリート**: AI支援によるコード補完が正常に動作するか
* **LSP統合**: 言語サーバープロトコルによる編集支援が正常に動作するか

#### 4.1.3 テスト要件

* 正常系・異常系ともにテスト実行
* エッジケースのテスト実施

### 4.2 UI/UX チェック

#### 4.2.1 デザイン一貫性

* **レイアウト**: Gridモードと3Dモードのレイアウトが一貫しているか
* **スタイリング**: Tailwind CSSによる一貫したスタイリング
* **コンポーネント**: `@/components/ui`の再利用可能なコンポーネントを使用しているか
* **レスポンシブ対応**: 様々な画面サイズに対応しているか

#### 4.2.2 アクセシビリティ

* **Radix UI**: アクセシブルなUIコンポーネントの適切な使用
* **キーボード操作**: キーボードショートカットが正常に動作するか
* **スクリーンリーダー**: アクセシビリティガイドラインへの準拠

#### 4.2.3 ユーザビリティ

* **直感的な操作**: ユーザーが迷うことなく操作できるか
* **エラーメッセージ**: 適切なエラーメッセージとリカバリー
* **フィードバック**: 操作に対する適切な視覚的フィードバック

### 4.3 パフォーマンスチェック

#### 4.3.1 3Dレンダリング性能

* **フレームレート**: 3Dモードで60fpsを維持しているか
* **レンダリング負荷**: 大量のセル配置時のパフォーマンス
* **メモリ使用量**: 3Dシーンのメモリ使用量が適切か

#### 4.3.2 アプリケーション性能

* **起動時間**: アプリケーションの起動時間を測定
* **応答時間**: セル実行、モード切り替え、UI操作の応答性
* **ページロード時間**: 初期ロード時間の測定

#### 4.3.3 データ処理性能

* **大規模データ**: 大量のセルやデータの処理性能
* **仮想化**: 必要に応じて仮想化ライブラリ（`react-virtuoso`）の使用
* **ボトルネック**: パフォーマンスボトルネック箇所の特定と最適化

### 4.4 セキュリティチェック

#### 4.4.1 入力検証

* **Zodバリデーション**: ユーザー入力の適切なスキーマバリデーション
* **XSS対策**: DOM操作時の適切なサニタイゼーション（`dompurify`の使用）
* **SQLインジェクション**: データベースクエリの適切なエスケープ

#### 4.4.2 通信セキュリティ

* **WebSocket通信**: セキュアな通信プロトコルの確保
* **データ送信**: 機密情報の適切な保護

#### 4.4.3 ログ・デバッグ情報

* **機密情報**: 認証トークン、パスワードなどのログ出力禁止
* **ログレベル**: 適切なログレベルの管理

### 4.5 互換性チェック

#### 4.5.1 ブラウザ互換性

* **主要ブラウザ**: Chrome、Firefox、Safari、Edgeでの動作確認
* **バージョン**: 最新版および1つ前のメジャーバージョンでの動作確認

#### 4.5.2 プラットフォーム互換性

* **Webアプリケーション**: ブラウザ環境での動作確認
* **Electronアプリケーション**: Windows、macOS、Linuxでの動作確認（オプション）

#### 4.5.3 デバイス互換性

* **画面サイズ**: 様々な画面サイズでのレスポンシブ対応確認
* **入力デバイス**: マウス、キーボード、タッチ操作の対応確認

### 4.6 リリース品質審査

* 重大・高優先度のバグが解決済みであること
* QA サインオフを得たこと

---

## 5. 品質指標（Metrics）

定量的な指標を用いることで品質の状態を客観評価できます。

### 5.1 テスト指標

* **テストカバレッジ**: ユニットテスト・統合テストのカバレッジ率
* **テスト実行時間**: テストスイートの実行時間
* **テスト成功率**: テストのパス率

### 5.2 コード品質指標

* **型安全性**: TypeScriptの型エラー数
* **リンター警告**: Biomeによる警告・エラー数
* **コード複雑度**: 関数・コンポーネントの複雑度

### 5.3 パフォーマンス指標

* **3DレンダリングFPS**: 3Dモードの平均フレームレート
* **起動時間**: アプリケーションの起動時間
* **応答時間**: セル実行、モード切り替えの平均応答時間

### 5.4 バグ・セキュリティ指標

* **バグ件数**: バグ件数と重症度分布
* **セキュリティアラート**: 依存関係の脆弱性アラート数
* **バグ解決時間**: バグ発見から解決までの平均時間

### 5.5 指標の追跡

品質指標は継続的に追跡し、改善に繋げます。定期的なレビューと改善アクションを実施します。([ONES.com][1])

---

## 6. 品質改善とレビュープロセス

品質は一度だけで担保するものではなく、「反復的な改善プロセス」として扱います。

### 6.1 コードレビュー

* **プルリクエスト**: すべてのコード変更はプルリクエストを通じてレビュー
* **レビュー基準**: プロジェクト仕様書の禁止事項・推奨事項に準拠
* **自動チェック**: CIによる自動チェック（型チェック、リンター、テスト）を通過

### 6.2 バグ分析

* **根本原因分析**: バグの根本原因を特定し、再発防止策を検討
* **バグ分類**: バグの重症度とカテゴリによる分類
* **トレンド分析**: バグの発生傾向を分析し、予防策を検討

### 6.3 振り返り

* **定期的な振り返り**: 品質指標を基にした定期的な振り返りミーティング
* **改善アクション**: 振り返りで特定された改善点に対するアクションアイテム
* **ベストプラクティス**: 成功事例の共有とベストプラクティスの文書化

### 6.4 継続的改善

これにより品質向上サイクルが形成され、継続的な品質改善が実現されます。([ONES.com][1])

---

## 7. テスト実行コマンド

### 7.1 開発環境でのテスト実行

```powershell
# 型チェック
pnpm typecheck

# リンター
pnpm lint

# ユニットテスト（Vitest）
# 個別ファイルのテスト実行
pnpm test src/path/to/file.test.ts

# すべてのテスト実行
pnpm test

# E2Eテスト（Playwright）
# 注意: バックエンドサーバーが起動している必要があります
pnpm test:e2e
```

### 7.2 テスト実行の前提条件

* **バックエンドサーバー**: 統合テスト・E2Eテスト実行時はサーバーが起動していること
* **環境変数**: 必要な環境変数が設定されていること
* **依存関係**: `pnpm install`で依存関係がインストールされていること

### 7.3 3段階デバッグプロセス

問題が発生した場合、以下の順序でテストを実行して原因を特定します：

1. **Backendテスト**: バックエンドのテストを実行して問題を切り分け
2. **Frontend統合テスト**: フロントエンドの統合テストを実行（サーバー起動必須）
3. **E2Eテスト**: エンドツーエンドテストで最終確認

---

## 8. ドキュメント更新と保守

本ガイドラインはプロジェクト進行に伴い更新します。
バージョン管理システムで管理し、変更履歴を残してください。

### 8.1 関連ドキュメント

* [プロジェクト仕様書](./project_specification.md): プロジェクトの目的、要件、技術スタック、制約
* `.cursor/rules/`: 開発ルールとガイドライン

### 8.2 更新履歴

* **2026年1月**: 初版作成、プロジェクト仕様書との整合性確保

---

**最終更新**: 2026年1月  
**バージョン**: 1.0.0

---

## 参考資料

[1]: https://ones.com/ja/blog/software-quality-assurance-tips/?utm_source=chatgpt.com "品質担保する5つの秘訣：ソフトウェア開発の信頼性を高める方法"
[2]: https://katalon.com/resources-center/blog/web-qa-checklist?utm_source=chatgpt.com "A Comprehensive QA Checklist For Websites And Software"
